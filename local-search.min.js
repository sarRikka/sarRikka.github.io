function searchEscape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return e.replace(/[&<>"'/]/g,function(e){return t[e]})}function regEscape(e){const t={"{":"\\{","}":"\\}","[":"\\[","]":"\\]","(":"\\(",")":"\\)","?":"\\?","*":"\\*",".":"\\.","+":"\\+","^":"\\^",$:"\\$"};return e.replace(/[\{\}\[\]\(\)\?\*\.\+\^\$]/g,function(e){return t[e]})}function getParam(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function setNotice(e,t){const n=document.getElementById("kr-search-notice");n.className="alert alert-"+e,n.innerText=t}function clearPosts(){document.getElementById("result-posts").innerHTML=""}function createPosts(e){const t=document.getElementById("result-posts");let c="";e.forEach(e=>{const t=e[0];let n="";t.tags.forEach((e,t)=>{n+=t?", ":"";e=`<a class="tag-link" href="${e[1]}" rel="tag">${e[0]}</a>`;n+=e});e=`\n        <article class="kratos-hentry clearfix">\n            <div class="kratos-entry-border-new clearfix">\n                <div class="kratos-post-inner-new kr-search-result">\n                    <header class="kratos-entry-header-new">\n                        ${"undefined"!==t.category[0]?`<a class="label-link" href="${t.category[1]}">${t.category[0]}</a>`:""}\n                        <h2 class="kratos-entry-title-new"><a href="${t.link}">${t.title}</a></h2>\n                    </header>\n                    <div class="kratos-entry-content-new">\n                        <p>...${t.content}...</p>\n                    </div>\n                </div>\n                <div class="kratos-post-meta-new">\n                    <span class="pull-left">\n                        <a><i class="fa fa-calendar"></i></a><a>${t.date}</a>\n                        <a><i class="fa fa-tags"></i></a>\n                        ${n}\n                    </span>\n                </div>\n            </div>\n        </article>\n        `;c+=e}),t.innerHTML=c}function loadDataSearch(e,n){fetch(e).then(e=>(setNotice("success","文件加载完成，开始搜索啦~"),"undefined"!=typeof NProgress&&NProgress.inc(),e.json())).then(e=>{var t=performance.now();let s=[],o=0,i=n.trim().toLowerCase().split(/\s/);if(e.forEach(e=>{if(void 0!==e.title&&void 0!==e.content){let t=!1;const n=e.title.trim().toLowerCase(),a=e.content?e.content.trim().replace(/<[^>]+>/g,"").toLowerCase():"";let c=0,r={title:-1,content:-1,firstOccur:-1,lastOccur:-1};if(n&&i.forEach(e=>{r.title=n.indexOf(e),r.content=a.indexOf(e),-1===r.title&&-1===r.content||(t=!0,-1!==r.content?((r.firstOccur>r.content||-1===r.firstOccur)&&(r.firstOccur=r.content),r.lastOccur<r.content&&(r.lastOccur=r.content)):(r.firstOccur=100,r.lastOccur=0),c+=-1!==r.title?2:0,c+=-1!==r.content?1:0,o++)}),t){let n={};if(n.title=e.title,n.date=new Date(e.date).toLocaleDateString(),n.tags=e.tags||[],n.category=e.categories[0]||[],n.link=e.url,i.forEach(e=>{e=new RegExp(regEscape(e)+"(?!>)","gi");n.title=n.title.replace(e,"<m>$&</m>")}),0<=r.firstOccur){let e=r.firstOccur-100,t=r.lastOccur+100;e<0&&(e=0),0===e&&(t=200),t>a.length&&(t=a.length),n.content=a.substr(e,t-e),i.forEach(e=>{e=new RegExp(regEscape(e)+"(?!>)","gi");n.content=n.content.replace(e,"<m>$&</m>")})}s.push([n,c])}}}),0!==o){const e=performance.now();setNotice("success","找到 "+o+" 条搜索结果，用时 "+Math.round(100*(e-t))/100+" 毫秒~"),s.sort((e,t)=>t[1]-e[1]),createPosts(s)}else setNotice("danger","什么都没有找到欸..."),clearPosts();"undefined"!=typeof NProgress&&NProgress.done()}).catch(e=>{setNotice("danger","错误 : "+e)})}function keySearch(e){setNotice("info","正在加载搜索文件..."),"undefined"!=typeof NProgress&&NProgress.start(),loadDataSearch(searchDataFile,searchEscape(e))}function inpSearch(){const e=document.getElementById("search-input").value;return window.history.pushState({},0,window.location.href.split("?")[0]+"?s="+e.replace(/\s/g,"+")),keySearch(e),!1}(()=>{var e=getParam("s");""!==e&&keySearch(document.getElementById("search-input").value=e)})();